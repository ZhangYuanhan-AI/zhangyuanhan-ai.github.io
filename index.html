<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="David_Zhang">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="David_Zhang">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="David_Zhang">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>David_Zhang</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">David_Zhang</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/15/ROI-Align/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yuanhan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="David_Zhang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/15/ROI-Align/" itemprop="url">ROI Align</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-15T19:28:41+08:00">
                2019-08-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Deep-Trick/" itemprop="url" rel="index">
                    <span itemprop="name">Deep Trick</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/08/15/ROI-Align/" class="leancloud_visitors" data-flag-title="ROI Align">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#ROI Align</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://zhuanlan.zhihu.com/p/37998710" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/37998710</a></li>
</ol>
<blockquote>
<h2 id="ROIpooling"><a href="#ROIpooling" class="headerlink" title="ROIpooling"></a>ROIpooling</h2><p>ROI pooling就不多解释了，直接通过一个例子来形象理解。假设现在我们有一个8x8大小的feature map，我们要在这个feature map上得到ROI，并且进行ROI pooling到2x2大小的输出。</p>
<p><img src="https://pic2.zhimg.com/80/v2-17d3c689270ac638d9aafd90b96149e5_hd.jpg" alt="img"></p>
<p>假设ROI的bounding box为 <img src="https://www.zhihu.com/equation?tex=%5Bx_1%2Cy_1%2Cx_2%2Cy_2%5D%3D%5B0%2C3%2C7%2C8%5D" alt="[公式]"> 。如图：</p>
<p><img src="https://pic3.zhimg.com/80/v2-b52b7f305f1aaea6febfe0d22a7d23da_hd.jpg" alt="img"></p>
<p>将它划分为2x2的网格，因为ROI的长宽除以2是不能整除的，所以会出现每个格子大小不一样的情况。</p>
<p><img src="https://pic4.zhimg.com/80/v2-5ba9049300789586c29f78ebc2a5acb7_hd.jpg" alt="img"></p>
<p>进行max pooling的最终2x2的输出为：</p>
<p><img src="https://pic1.zhimg.com/80/v2-df2414cb2eb3ae6e3bc30b9289cf5c44_hd.jpg" alt="img"></p>
<p>最后以一张动图形象概括之：</p>
<p><img src="https://pic4.zhimg.com/v2-e55e66c9c21136efa62beacfcb02f9ef_b.gif" alt="img"></p>
<p>参考：<a href="https://link.zhihu.com/?target=https%3A//blog.deepsense.ai/region-of-interest-pooling-explained/" target="_blank" rel="noopener">Region of interest pooling explained</a></p>
<h2 id="3-ROI-Align"><a href="#3-ROI-Align" class="headerlink" title="3. ROI Align"></a>3. ROI Align</h2><p>在Faster RCNN中，有两次整数化的过程：</p>
<ol>
<li>region proposal的xywh通常是小数，但是为了方便操作会把它整数化。</li>
<li>将整数化后的边界区域平均分割成 k x k 个单元，对每一个单元的边界进行整数化。</li>
</ol>
<p>两次整数化的过程如下图所示：</p>
<p><img src="https://pic3.zhimg.com/80/v2-36e08338390289e0dd88203b4e8ddda2_hd.jpg" alt="img"></p>
<p>事实上，经过上述两次整数化，此时的候选框已经和最开始回归出来的位置有一定的偏差，这个偏差会影响检测或者分割的准确度。在论文里，作者把它总结为“不匹配问题”（misalignment）。</p>
<p>为了解决这个问题，ROI Align方法取消整数化操作，保留了小数，使用以上介绍的双线性插值的方法获得坐标为浮点数的像素点上的图像数值。但在实际操作中，ROI Align并不是简单地补充出候选区域边界上的坐标点，然后进行池化，而是重新进行设计。</p>
<p>下面通过一个例子来讲解ROI Align操作。如下图所示，虚线部分表示feature map，实线表示ROI，这里将ROI切分成2x2的单元格。如果采样点数是4，那我们首先将每个单元格子均分成四个小方格（如红色线所示），每个小方格中心就是采样点。这些采样点的坐标通常是浮点数，所以需要对采样点像素进行双线性插值（如四个箭头所示），就可以得到该像素点的值了。然后对每个单元格内的四个采样点进行maxpooling，就可以得到最终的ROIAlign的结果。</p>
<p><img src="https://pic1.zhimg.com/80/v2-76b8a15c735d560f73718581de34249c_hd.jpg" alt="img"></p>
<p>需要说明的是，在相关实验中，作者发现将采样点设为4会获得最佳性能，甚至直接设为1在性能上也相差无几。事实上，ROI Align 在遍历取样点的数量上没有ROIPooling那么多，但却可以获得更好的性能，这主要归功于解决了misalignment的问题。</p>
</blockquote>
<p>个人补充：实际上最后应该是要得到13*13的feature map 那么就要把ROI化成13个bin，注意每个bin还要划分4格，每个格子的中心是个浮点数要通过插值把其真实值插出来，然后对这4个小格子的值做最后的maxpooling得到这个bin的值。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/15/NMS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yuanhan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="David_Zhang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/15/NMS/" itemprop="url">NMS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-15T16:43:31+08:00">
                2019-08-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Deep-Trick/" itemprop="url" rel="index">
                    <span itemprop="name">Deep Trick</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/08/15/NMS/" class="leancloud_visitors" data-flag-title="NMS">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="NMS"><a href="#NMS" class="headerlink" title="NMS"></a>NMS</h1><p>通常来说有两种NMS</p>
<ol>
<li><p>SSD fasterRCNN</p>
<ul>
<li><p>置信度小于阈值的proposal（anchor）score都变为0</p>
</li>
<li><p>将score排序，从score最高的开始，把与当前score最高的proposal（anchor）IOU大于阈值的proposal（anchor）过滤掉，重复当前步骤知道无法继续。</p>
</li>
</ul>
</li>
<li><p>YOLO</p>
<p>每个类别都做NMS</p>
<blockquote>
<p>首先将小于置信度阈值的值归0，然后分类别地对置信度值采用NMS，这里NMS处理结果不是剔除，而是将其置信度值归为0。最后才是确定各个box的类别，当其置信度值不为0时才做出检测结果输出。</p>
</blockquote>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/15/YOLOV2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yuanhan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="David_Zhang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/15/YOLOV2/" itemprop="url">YOLOV2 and YOLOV3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-15T14:07:23+08:00">
                2019-08-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2019/08/15/YOLOV2/" class="leancloud_visitors" data-flag-title="YOLOV2 and YOLOV3">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="YOLOV2"><a href="#YOLOV2" class="headerlink" title="YOLOV2"></a>YOLOV2</h1><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ol>
<li><a href="https://zhuanlan.zhihu.com/p/35325884" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/35325884</a></li>
</ol>
<h2 id="Highlight"><a href="#Highlight" class="headerlink" title="Highlight"></a>Highlight</h2><ol>
<li><p>最后的feature map为13 * 13大小，每个bin有5个anchor，预测（x,y,w,h,confi,class）取消了YOLOv1的全连接。</p>
</li>
<li><p>引入了anchor</p>
<ul>
<li>anchor大小的设定和原图无关（SSD中anchor的大小和原图相关),anchor的计算通过Kmeans聚类(<a href="https://blog.csdn.net/huangfei711/article/details/78480078" target="_blank" rel="noopener">https://blog.csdn.net/huangfei711/article/details/78480078</a>) (聚类距离是1- IOU)训练集的GT框的大小来得到，源码中这些特征框的数值应该是对于原图的比例。</li>
<li>每个anchor都对应了一组GT（和YOLOv1不同）和（SSD）类似。</li>
</ul>
</li>
<li><p>BB的数值变成偏移量-和SSD相同</p>
</li>
<li><p>Fine-Grained Features</p>
<blockquote>
<p>YOLOv2提出了一种passthrough层来利用更精细的特征图。YOLOv2所利用的Fine-Grained Features是 <img src="https://www.zhihu.com/equation?tex=26%5Ctimes26" alt="[公式]"> 大小的特征图（最后一个maxpooling层的输入），对于Darknet-19模型来说就是大小为 <img src="https://www.zhihu.com/equation?tex=26%5Ctimes26%5Ctimes512" alt="[公式]"> 的特征图。passthrough层与ResNet网络的shortcut类似，以前面更高分辨率的特征图为输入，然后将其连接到后面的低分辨率特征图上。前面的特征图维度是后面的特征图的2倍，passthrough层抽取前面层的每个 <img src="https://www.zhihu.com/equation?tex=2%5Ctimes2" alt="[公式]"> 的局部区域，然后将其转化为channel维度，对于 <img src="https://www.zhihu.com/equation?tex=26%5Ctimes26%5Ctimes512" alt="[公式]"> 的特征图，经passthrough层处理之后就变成了 <img src="https://www.zhihu.com/equation?tex=13%5Ctimes13%5Ctimes2048" alt="[公式]"> 的新特征图（特征图大小降低4倍，而channles增加4倍，图6为一个实例），这样就可以与后面的 <img src="https://www.zhihu.com/equation?tex=13%5Ctimes13%5Ctimes1024" alt="[公式]"> 特征图连接在一起形成 <img src="https://www.zhihu.com/equation?tex=13%5Ctimes13%5Ctimes3072" alt="[公式]"> 大小的特征图，然后在此特征图基础上卷积做预测。</p>
<p><img src="https://pic3.zhimg.com/80/v2-c94c787a81c1216d8963f7c173c6f086_hd.jpg" alt="img">图6：passthrough层实例</p>
</blockquote>
</li>
<li><p>Multi-Scale Training</p>
</li>
<li><blockquote>
<p>由于YOLOv2模型中只有卷积层和池化层，所以YOLOv2的输入可以不限于 <img src="https://www.zhihu.com/equation?tex=416%5Ctimes416" alt="[公式]"> 大小的图片。为了增强模型的鲁棒性，YOLOv2采用了多尺度输入训练策略，具体来说就是在训练过程中每间隔一定的iterations之后改变模型的输入图片大小。由于YOLOv2的下采样总步长为32，输入图片大小选择一系列为32倍数的值： <img src="https://www.zhihu.com/equation?tex=%5C%7B320%2C+352%2C...%2C+608%5C%7D" alt="[公式]"> ，输入图片最小为 <img src="https://www.zhihu.com/equation?tex=320%5Ctimes320" alt="[公式]"> ，此时对应的特征图大小为 <img src="https://www.zhihu.com/equation?tex=10%5Ctimes10" alt="[公式]"> （不是奇数了，确实有点尴尬），而输入图片最大为 <img src="https://www.zhihu.com/equation?tex=608%5Ctimes608" alt="[公式]">，对应的特征图大小为 <img src="https://www.zhihu.com/equation?tex=19%5Ctimes19" alt="[公式]"> 。在训练过程，每隔10个iterations随机选择一种输入图片大小，然后只需要修改对最后检测层的处理就可以重新训练。</p>
<p><img src="https://pic2.zhimg.com/80/v2-3c72c10c00c9268091d8c93f908d90ed_hd.jpg" alt="img">图7：Multi-Scale Training</p>
<p>采用Multi-Scale Training策略，YOLOv2可以适应不同大小的图片，并且预测出很好的结果</p>
</blockquote>
</li>
<li><p>GT的选择</p>
<blockquote>
<ol>
<li>哪些预测框来预测背景呢，需要先计算各个预测框和所有ground truth的IOU值，并且取最大值Max_IOU，如果该值小于一定的阈值（YOLOv2使用的是0.6），那么这个预测框就标记为background。</li>
<li>对于某个ground truth，首先要确定其中心点要落在哪个cell上，然后计算这个cell的5个先验框与ground truth的IOU值（YOLOv2中bias_match=1），计算IOU值时不考虑坐标，<strong>只考虑形状</strong>，所以先将先验框与ground truth的中心点都偏移到同一位置（原点），然后计算出对应的IOU值，IOU值最大的那个先验框与ground truth匹配，对应的预测框用来预测这个ground truth。（不同于SSD，YOLOV2一个GT只和一个anchor匹配）。</li>
<li>对于那些没有与ground truth匹配的先验框（与预测框对应），除去那些Max_IOU低于阈值的（变成background），其它的就全部忽略，不计算任何误差。（不计算，中间不计算和fasterRCNN有点像，但是fasterRCNN一个GT可以对应多个anchor，重合的anchor在proposa到后面head的时候通过NMS除掉）</li>
</ol>
</blockquote>
</li>
</ol>
<h1 id="YOLOV3"><a href="#YOLOV3" class="headerlink" title="YOLOV3"></a>YOLOV3</h1><h2 id="Highlight-1"><a href="#Highlight-1" class="headerlink" title="Highlight"></a>Highlight</h2><p>加上了FPN和Resnet</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/15/Focal-Loss/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yuanhan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="David_Zhang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/15/Focal-Loss/" itemprop="url">Focal Loss</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-15T12:02:01+08:00">
                2019-08-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Deep-Trick/" itemprop="url" rel="index">
                    <span itemprop="name">Deep Trick</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/08/15/Focal-Loss/" class="leancloud_visitors" data-flag-title="Focal Loss">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Focal-Loss"><a href="#Focal-Loss" class="headerlink" title="Focal Loss"></a>Focal Loss</h1><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://zhuanlan.zhihu.com/p/32423092" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/32423092</a></p>
<p>这篇文章特别清晰的解释了Focal Loss的推导。</p>
<p>中心思想：</p>
<p>让网络集中力量训练不好训练的部分。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/14/Random-Forest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yuanhan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="David_Zhang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/14/Random-Forest/" itemprop="url">Random Forest</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-14T14:43:49+08:00">
                2019-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/08/14/Random-Forest/" class="leancloud_visitors" data-flag-title="Random Forest">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Random-Forest"><a href="#Random-Forest" class="headerlink" title="Random Forest"></a>Random Forest</h1><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://zhuanlan.zhihu.com/p/34534004" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34534004</a></p>
<h2 id="Highlight"><a href="#Highlight" class="headerlink" title="Highlight"></a>Highlight</h2><ol>
<li><p>数据的随机选取</p>
<blockquote>
<p>从原始的数据集中采取<strong>有放回的抽样</strong>（bootstrap），构造子数据集，子数据集的数据量是和原始数据集相同的。不同子数据集的元素可以重复，同一个子数据集中的元素也可以重复。</p>
</blockquote>
<blockquote>
<p>利用子数据集来构建子决策树，将这个数据放到每个子决策树中，每个子决策树输出一个结果。最后，如果有了新的数据需要通过随机森林得到分类结果，就可以通过对子决策树的判断结果的投票，得到随机森林的输出结果了。如下图，假设随机森林中有3棵子决策树，2棵子树的分类结果是A类，1棵子树的分类结果是B类，那么随机森林的分类结果就是A类。</p>
</blockquote>
<p><img src="https://i.loli.net/2019/08/14/HxKNg6ewJha1q72.jpg" alt="123321.jpg"></p>
</li>
<li><p>待选特征的随机选取</p>
<blockquote>
<p>与数据集的随机选取类似，随机森林中的子树的每一个分裂过程并未用到所有的待选特征，而是从所有的待选特征中随机选取一定的特征，之后再在随机选取的特征中选取最优的特征。这样能够使得随机森林中的决策树都能够彼此不同，提升系统的多样性，从而提升分类性能。</p>
</blockquote>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/14/Decision-Tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yuanhan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="David_Zhang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/14/Decision-Tree/" itemprop="url">Decision Tree</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-14T14:43:36+08:00">
                2019-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/08/14/Decision-Tree/" class="leancloud_visitors" data-flag-title="Decision Tree">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Decision-Tree"><a href="#Decision-Tree" class="headerlink" title="Decision Tree"></a>Decision Tree</h1><h2 id="回归树"><a href="#回归树" class="headerlink" title="回归树"></a>回归树</h2><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p><a href="https://blog.csdn.net/weixin_40604987/article/details/79296427" target="_blank" rel="noopener">https://blog.csdn.net/weixin_40604987/article/details/79296427</a></p>
<h3 id="划分分裂的方法"><a href="#划分分裂的方法" class="headerlink" title="划分分裂的方法"></a>划分分裂的方法</h3><ol>
<li><p>最小二乘法分裂</p>
<ul>
<li><p>决定一个属性</p>
</li>
<li><p>基于该属性决定切分点</p>
</li>
<li><p>通过切分点左右区域分别计算y的均值c1,c2（这个时候y的取值有很多，不只是0，1）</p>
</li>
<li><p>算两个区域每个y（y1,y2,y2…yn）值和自己区域均值(c1/c2)的平方差的和</p>
</li>
<li><p>把最小平方差对应的切分点作为当前切分点。</p>
</li>
</ul>
</li>
</ol>
<h2 id="分类树"><a href="#分类树" class="headerlink" title="分类树"></a>分类树</h2><h3 id="参考文献-1"><a href="#参考文献-1" class="headerlink" title="参考文献"></a>参考文献</h3><ol>
<li><a href="https://zhuanlan.zhihu.com/p/26703300" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/26703300</a></li>
</ol>
<h3 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h3><p><img src="https://i.loli.net/2019/08/14/ASu16D9PMYIeQ7r.png" alt="决策树_西瓜.png"></p>
<p><img src="https://i.loli.net/2019/08/14/6tWgncNL7xZkI1j.png" alt="西瓜_结果.png"></p>
<p>根据每个属性和纯度的关系求出当前的分裂属性</p>
<blockquote>
<p>所谓分裂属性就是在某个节点处按照某一特征属性的不同划分构造不同的分支，其目标是让各个分裂子集尽可能地“纯”。尽可能“纯”就是尽量让一个分裂子集中待分类项属于同一类别。<strong>而判断“纯”的方法不同引出了我们的ID3算法，C4.5算法以及CART算法</strong>–<a href="https://zhuanlan.zhihu.com/p/26760551" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/26760551</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/14/Boosting-and-Bagging/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yuanhan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="David_Zhang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/14/Boosting-and-Bagging/" itemprop="url">Boosting and Bagging</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-14T14:42:15+08:00">
                2019-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/08/14/Boosting-and-Bagging/" class="leancloud_visitors" data-flag-title="Boosting and Bagging">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Bagging"><a href="#Bagging" class="headerlink" title="Bagging"></a>Bagging</h1><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://zhuanlan.zhihu.com/p/37730184" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/37730184</a></li>
</ol>
<h2 id="Highlight"><a href="#Highlight" class="headerlink" title="Highlight"></a>Highlight</h2><ol>
<li><p>可并行的集成方法。每个基模型可以分别、独立、互不影响地生成。</p>
</li>
<li><p>主要降低 Variance</p>
<ul>
<li><p>因为每个支路的数据为可以近似为独立，所以有如下结果</p>
<blockquote>
<p>方差有两个重要的性质，如下：</p>
<p>1、c为常数，则</p>
<p><img src="https://www.zhihu.com/equation?tex=Var%28cX%29+%3D+E%5B%28cX+-+E%5BcX%5D%29%5E2%5D+%3D+c%5E2E%5B%28X-E%5BX%5D%29%5E2%5D+%3D+c%5E2Var%28X%29+%5Cqquad+%281%29" alt="[公式]"></p>
<p>2、<strong>独立</strong>随机变量之和的方差等于各变量的方差之和：</p>
<p> <img src="https://www.zhihu.com/equation?tex=Var%28X_1+%2B+%5Ccdots+%2B+X_n%29+%3D+Var%28X_1%29+%2B+%5Ccdots+%2BVar%28X_n%29+%5Cqquad+%282%29" alt="[公式]"></p>
<p>如果各模型独立，根据（1）（2）可知，整体方差<img src="https://www.zhihu.com/equation?tex=Var%28%5Cfrac%7B1%7D%7Bn%7D%5Csum%5Climits_%7Bi%3D1%7D%5En+X_i%29+%3D+%5Cfrac%7B1%7D%7Bn%5E2%7DVar%28%5Csum%5Climits_%7Bi%3D1%7D%5EnX_i%29+%3D+%5Cfrac%7B%5Csigma%5E2%7D%7Bn%7D+%5Cqquad+%283%29" alt="[公式]"></p>
<p>因此Bagging可以减少方差。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>对于每一个支路随机采样</p>
</li>
</ol>
<h2 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h2><p><strong>Random Forest</strong> — 最典型的结构</p>
<p><img src="https://i.loli.net/2019/08/14/fiFv2cSHl9GKLNB.png" alt="bagging.png"></p>
<h1 id="Boosting"><a href="#Boosting" class="headerlink" title="Boosting"></a>Boosting</h1><h2 id="参考文献-1"><a href="#参考文献-1" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://zhuanlan.zhihu.com/p/37358517" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/37358517</a></li>
<li><a href="https://blog.csdn.net/zwqjoy/article/details/80424783" target="_blank" rel="noopener">https://blog.csdn.net/zwqjoy/article/details/80424783</a></li>
</ol>
<h2 id="Highlight-1"><a href="#Highlight-1" class="headerlink" title="Highlight"></a>Highlight</h2><ol>
<li><p>串形结构</p>
</li>
<li><p>可以减少bias</p>
</li>
<li><p>没有随机采样</p>
</li>
</ol>
<h2 id="Structure-1"><a href="#Structure-1" class="headerlink" title="Structure"></a>Structure</h2><p>大部分都是参考的内容，我把觉得有趣的在这里写了下</p>
<ol>
<li><p>加法模型</p>
<p> <img src="https://www.zhihu.com/equation?tex=f%28x%29+%3D+%5Csum_%7Bm%3D1%7D%5E%7BM%7D%5Calpha_%7Bm%7DG_%7Bm%7D%28x%29" alt="[公式]"></p>
</li>
<li><p>下一轮的样本值</p>
<blockquote>
<p> 由 <img src="https://www.zhihu.com/equation?tex=w_%7Bi%7D%5E%7B%28m%2B1%29%7D+%3D+e%5E%7B-y_%7Bi%7Df_%7Bm%7D%28x_%7Bi%7D%29%7D+%3D+e%5E%7B-y_%7Bi%7D%28f_%7Bm-1%7D%28x_%7Bi%7D%29+%2B+%5Calpha+G%28x_%7Bi%7D%29%29%7D+%3D+e%5E%7B-y_if_%7Bm-1%7D%28x_i%29%7De%5E%7B-y_i%5Calpha_mG_m%28x_i%29%7D+%3D+w_i%5E%7B%28m%29%7De%5E%7B-y_i%5Calpha_mG_m%28x_i%29%7D" alt="[公式]"></p>
<p>可以看到对于 <img src="https://www.zhihu.com/equation?tex=%5Calpha_m%3E0" alt="[公式]"> ，若 <img src="https://www.zhihu.com/equation?tex=y_i+%3D+G_m%28x_i%29" alt="[公式]"> ，则 <img src="https://www.zhihu.com/equation?tex=w_i%5E%7B%28m%2B1%29%7D+%3D+w_i%5E%7B%28m%29%7De%5E%7B-%5Calpha_m%7D" alt="[公式]"> ，表明前一轮被正确分类样本的权值会减小； 若 <img src="https://www.zhihu.com/equation?tex=y_i+%5Cneq+G_m%28x_i%29" alt="[公式]"> ，则 <img src="https://www.zhihu.com/equation?tex=w_i%5E%7B%28m%2B1%29%7D+%3D+w_i%5E%7B%28m%29%7De%5E%7B%5Calpha_m%7D" alt="[公式]"> ，表明前一轮误分类样本的权值会增大。</p>
</blockquote>
<p>注意这个时候G_m(x_i)已经通过下式子求出来了，下面这句话的意思是，求一个G(x_i)使得G(x_i)与yi不相等的数量最少，i指的第i个样本，每个样本都有一个W_i_m作为当前样本的权重，回到上面的式子，如果对当前样本分类正确，当前样本的权重会衰减，反之亦然。</p>
<blockquote>
<p>(a) 使用带有权值分布的训练集学习得到基学习器$G_m(x)$:<br> <img src="https://www.zhihu.com/equation?tex=G_m%28x%29+%3D+%5Cmathop%7B%5Carg%5Cmin%7D%5Climits_%7BG%28x%29%7D%5Csum%5Climits_%7Bi%3D1%7D%5ENw_i%5E%7B%28m%29%7D%5Cmathbb%7BI%7D%28y_i+%5Cneq+G%28x_i%29%29" alt="[公式]"></p>
</blockquote>
</li>
<li><p>G_m(x) (这个函数里面有和基函数的基数，比如基函数是e^x ,基数可以是2，3 使得，e^x - e^2x，e^3x)和 alpha_m（这个值是当前基函数在所有基函数中 的权重：准确率越高的基学习器会被赋予较大的系数。）<strong>这两个参数是对于当前轮而言的，当前轮的所有样本的这个两个参数相同</strong></p>
<blockquote>
<p>b) 计算 <img src="https://www.zhihu.com/equation?tex=G_m%28x%29" alt="[公式]"> 在训练集上的误差率：<br> <img src="https://www.zhihu.com/equation?tex=%5Cepsilon_m+%3D+%5Cfrac%7B%5Csum%5Climits_%7Bi%3D1%7D%5ENw_i%5E%7B%28m%29%7D%5Cmathbb%7BI%7D%28y_i+%5Cneq+G_m%28x_i%29%29%7D%7B%5Csum%5Climits_%7Bi%3D1%7D%5ENw_i%5E%7B%28m%29%7D%7D" alt="[公式]"><br>(c) 计算 <img src="https://www.zhihu.com/equation?tex=G_m%28x%29" alt="[公式]"> 的系数： <img src="https://www.zhihu.com/equation?tex=%5Calpha_m+%3D+%5Cfrac%7B1%7D%7B2%7Dln%5Cfrac%7B1-%5Cepsilon_m%7D%7B%5Cepsilon_m%7D" alt="[公式]"> </p>
<p>误差率越大，系数越小</p>
</blockquote>
</li>
<li><p>更新权重</p>
<blockquote>
<p> 更新样本权重分布： <img src="https://www.zhihu.com/equation?tex=w_%7Bi%7D%5E%7B%28m%2B1%29%7D+%3D+%5Cfrac%7Bw_i%5E%7B%28m%29%7De%5E%7B-y_i%5Calpha_mG_m%28x_i%29%7D%7D%7BZ%5E%7B%28m%29%7D%7D%5C%3B+%2C%5Cqquad+i%3D1%2C2%2C3%5Ccdots+N" alt="[公式]"><br>　　其中 <img src="https://www.zhihu.com/equation?tex=Z%5E%7B%28m%29%7D" alt="[公式]"> 是规范化因子， <img src="https://www.zhihu.com/equation?tex=Z%5E%7B%28m%29%7D+%3D+%5Csum%5Climits_%7Bi%3D1%7D%5ENw%5E%7B%28m%29%7Die%5E%7B-y_i%5Calpha_mG_m%28x_i%29%7D" alt="[公式]"> ，以确保所有的<br><img src="https://www.zhihu.com/equation?tex=w_i%5E%7B%28m%2B1%29%7D" alt="[公式]"> 构成一个分布。</p>
</blockquote>
<p>注意这个公式相对于前面（下一轮的样本值）的求法多除了一个Z</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/13/DeeplabV3+/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yuanhan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="David_Zhang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/13/DeeplabV3+/" itemprop="url">Deeplab</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-13T19:44:18+08:00">
                2019-08-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Paper-Reading/" itemprop="url" rel="index">
                    <span itemprop="name">Paper Reading</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/08/13/DeeplabV3+/" class="leancloud_visitors" data-flag-title="Deeplab">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="DeepLabV3"><a href="#DeepLabV3" class="headerlink" title="DeepLabV3"></a>DeepLabV3</h1><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://blog.csdn.net/bea_tree/article/details/73527732" target="_blank" rel="noopener">https://blog.csdn.net/bea_tree/article/details/73527732</a></li>
</ol>
<h2 id="Hightlight"><a href="#Hightlight" class="headerlink" title="Hightlight"></a>Hightlight</h2><ol>
<li><p>将HDC提出的方法融合到了DeepLabV3中，提出了Multi-Grid，解决Gridding effect。</p>
<ul>
<li><p>原本一个block内的卷积层，e.g. 三层，都是一个rate，这里将其分别变为不同的rates，比如将2×(1,1,1)【rate都是2，2，2】变为2×(1,2,1)【rate变为【2，4，2】。</p>
<blockquote>
<p><img src="https://img-blog.csdn.net/20170621110103120?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmVhX3RyZWU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><img src="https://img-blog.csdn.net/20170621111223743?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmVhX3RyZWU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
</blockquote>
<p>稍微说明：这里的rate指的是当前block的基本rate，假设Multi-Grid = （1，2，1），rate = 2对应到block4的rate就是（2，4，2）。对于Aspp的block4也同理</p>
</li>
</ul>
</li>
</ol>
<ol start="2">
<li><p>在原有的框架下提出了两个新的框架</p>
<ul>
<li>加长版 </li>
<li>增强版ASPP（deeplab v3） （global mapping层直接双线型插值到outstride = 16）</li>
</ul>
</li>
</ol>
<h2 id="Drawback"><a href="#Drawback" class="headerlink" title="Drawback"></a>Drawback</h2><p>直接上采样16倍/8倍—太粗暴！！！！</p>
<h1 id="DeeplabV3"><a href="#DeeplabV3" class="headerlink" title="DeeplabV3+"></a>DeeplabV3+</h1><h2 id="Highlight"><a href="#Highlight" class="headerlink" title="Highlight"></a>Highlight</h2><ol>
<li><p>给空洞卷积系列加上了decoder</p>
</li>
<li><p>主要是权衡计算时间和计算准确度的问题：</p>
<blockquote>
<p>Even though rich semantic information is encoded inthe last feature map, detailed information related to object boundaries is missing due to the pooling or convolutions with striding operations within the network backbone. This could be alleviated by applying the atrous convolution to extract denser feature maps. However, given the design of state-of-art neural networks [7,9,10,25,26] and limited GPU memory, it is computationally prohibitive to extract output feature maps that are 8, or even 4 times smaller than the input resolution.</p>
</blockquote>
</li>
<li><p>用decoder解决DeeplabV3中用插值上采样（16倍上采样，太粗暴）不够精确的问题。</p>
</li>
</ol>
<h2 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h2><p><img src="https://i.loli.net/2019/08/13/TXeiaAxzOt8wm6k.png" alt="1212.png"></p>
<p><img src="https://i.loli.net/2019/08/13/V2aNzQ1froxJjdn.png" alt="123.png"></p>
<h2 id="和Xeception结合"><a href="#和Xeception结合" class="headerlink" title="和Xeception结合"></a>和Xeception结合</h2><p>Pending</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/10/SSD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yuanhan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="David_Zhang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/10/SSD/" itemprop="url">SSD</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-10T11:14:36+08:00">
                2019-08-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Paper-Reading/" itemprop="url" rel="index">
                    <span itemprop="name">Paper Reading</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/08/10/SSD/" class="leancloud_visitors" data-flag-title="SSD">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SSD"><a href="#SSD" class="headerlink" title="SSD"></a>SSD</h1><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://zhuanlan.zhihu.com/p/33544892" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/33544892</a></p>
<h2 id="Hightlight"><a href="#Hightlight" class="headerlink" title="Hightlight"></a>Hightlight</h2><ol>
<li><p>One-stage</p>
</li>
<li><p>Multi-scale</p>
</li>
<li><p>又快又准</p>
</li>
<li><p>提出了Hard negative mining，解决样本不平衡。</p>
<ul>
<li>在负样本中（matching为背景）中选择置信度最高的几个，使得正负样本比例为3:1。</li>
</ul>
</li>
</ol>
<h2 id="和YOLOv1的区别"><a href="#和YOLOv1的区别" class="headerlink" title="和YOLOv1的区别"></a>和YOLOv1的区别</h2><ol>
<li><p>多尺度：</p>
<ul>
<li><p>对于YOLOv1，都是基于一个feature map上的操作。</p>
</li>
<li><p>对于SSD 有6个不同的feature map。</p>
</li>
</ul>
</li>
</ol>
<ol start="2">
<li><p>Bounding Box：</p>
<ul>
<li><p>对于YOLOv1，其最后要回归的是BB的真实坐标(Normalize)之后。</p>
</li>
<li><p>对于SSD，模拟fasterRcnn的anchor，BB由Base Anchor和偏移组成，最后回归的是偏移，另外，不同尺度下base anchor的大小不同，类比maskRcnn。</p>
</li>
</ul>
</li>
</ol>
<ol start="3">
<li><p>Matching strategy</p>
<ul>
<li>对于YOLOv1，如果一个bin中是一个物体的中心，那么该bin（最后是7*7的像素点）就负责预测这个物体。</li>
<li>对于SSD，matching 分为两个步骤（<strong>一个BB只能对于一个GT，但是一个GT可以对应多个BB</strong>）<ul>
<li>GT matching，GT只matching与自己IOU最高的，使得与自己IOU最高的BB的GT的类别为GT</li>
<li>BB matching，BB与自己IOU &gt; 0,5的GT matching，若有多个GT，BB选择IOU最高的。</li>
<li>前两部顺序不能变化，对于没有match的BB，其类别为背景。</li>
</ul>
</li>
</ul>
</li>
<li><p>classification</p>
<ul>
<li>对于YOLOv1，分类使用的是全联接。</li>
<li>对于SSD，分类用的是全卷积。</li>
</ul>
</li>
<li><p>classification</p>
<ul>
<li><p>对于YOLOv1，类别中不包括背景，用置信度的值来表示，是否是前景类别。</p>
</li>
<li><p>对于SSD，类别中包括背景。</p>
</li>
</ul>
</li>
</ol>
<ol start="6">
<li><p>classification</p>
<ul>
<li><p>对于YOLOv1，其class的loss是用的回归的平方误差</p>
</li>
<li><p>对于SSD用的是softmax</p>
</li>
</ul>
</li>
</ol>
<ol start="7">
<li><p>GT</p>
<ul>
<li>对于YOLOV1，一个bin对应两个BB，一个GT，两个BB共享一个GT。GT中有置信度和类别两个区域</li>
<li>对于SSD，一个bin对应k个Anchor，每个anchor有自己的的GT，GT中没有置信度。</li>
</ul>
</li>
<li><p>NMS</p>
<p>SSD只在预测的时候做NMS。</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/05/YOLOV1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yuanhan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="David_Zhang">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/05/YOLOV1/" itemprop="url">YOLOV1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-05T18:03:32+08:00">
                2019-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Paper-Reading/" itemprop="url" rel="index">
                    <span itemprop="name">Paper Reading</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/08/05/YOLOV1/" class="leancloud_visitors" data-flag-title="YOLOV1">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="YOLOV1"><a href="#YOLOV1" class="headerlink" title="YOLOV1"></a>YOLOV1</h1><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="https://zhuanlan.zhihu.com/p/46691043" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/46691043</a></li>
</ol>
<h2 id="Highlight"><a href="#Highlight" class="headerlink" title="Highlight"></a>Highlight</h2><ol>
<li><p>one-stage</p>
</li>
<li><p>每个bin负责预测物体中心在该bin的物体（由于狗中心在这个bin,所以这个bin负责预测狗）</p>
<p><img src="https://i.loli.net/2019/08/05/jQVU1LdbJewO7ZT.png" alt="1.png"></p>
</li>
<li><p>very fast</p>
</li>
</ol>
<h2 id="和FasterRcnn的Anchor的区别"><a href="#和FasterRcnn的Anchor的区别" class="headerlink" title="和FasterRcnn的Anchor的区别"></a>和FasterRcnn的Anchor的区别</h2><p>对于fasterRcnn的Anchor是基于一个预先定义好的anchor_base决定的，而对于YOLOv1来说其bbox的所有坐标完全是通过回归的方法生成的。</p>
<h2 id="训练阶段GT的生成"><a href="#训练阶段GT的生成" class="headerlink" title="训练阶段GT的生成"></a>训练阶段GT的生成</h2><p><img src="https://i.loli.net/2019/08/07/Wor27Iu9tGiH4me.png" alt="123.png"></p>
<h2 id="Loss"><a href="#Loss" class="headerlink" title="Loss"></a>Loss</h2><blockquote>
<p><img src="https://i.loli.net/2019/08/07/k1xcB7oKbY6DFzn.png" alt="321.png"></p>
</blockquote>
<p>另外需要注意的是，关于class的loss这里也完全用的是回归的方式而不是softmax。</p>
<h2 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h2><p><a href="https://blog.csdn.net/hrsstudy/article/details/70305791" target="_blank" rel="noopener">https://blog.csdn.net/hrsstudy/article/details/70305791</a></p>
<p><a href="https://my.oschina.net/u/876354/blog/1633143" target="_blank" rel="noopener">https://my.oschina.net/u/876354/blog/1633143</a></p>
<p><img src="https://i.loli.net/2019/08/09/bjmGqP4pvUBiZcJ.png" alt="2.png"></p>
<ol>
<li>卷积层怎么变成全联接层的（突然有点忘了 所以记录下来）<ul>
<li>比如这里卷积层是7 * 7 * 1024，第一个全联接层的结果是4096，所以这里要用到4096个7 * 7 * 1024大小的卷积核</li>
</ul>
</li>
<li>全联接层怎么变成卷积层的<ul>
<li>直接resize</li>
</ul>
</li>
</ol>
<p>作者：白裳</p>
<h2 id="YOLO中的Bounding-Box-Normalization"><a href="#YOLO中的Bounding-Box-Normalization" class="headerlink" title="YOLO中的Bounding Box Normalization"></a>YOLO中的Bounding Box Normalization</h2><blockquote>
<p>YOLO在实现中有一个重要细节，即对bounding box的坐标(x, y, w, h)进行了normalization，以便进行回归。作者认为这是一个非常重要的细节。在原文2.2 Traing节中有如下一段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; Our final layer predicts both class probabilities and bounding box coordinates.</span><br><span class="line">&gt; We normalize the bounding box width and height by the image width and height so that they fall between 0 and 1.</span><br><span class="line">&gt; We parametrize the bounding box x and y coordinates to be offsets of a particular grid cell location so they are also bounded between 0 and 1.</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>接下来分析一下到底如何实现。</p>
<p><img src="https://pic4.zhimg.com/v2-09c3012b2ff765dc01fa65d10d6b322f_b.jpg" alt="img"><img src="https://pic4.zhimg.com/80/v2-09c3012b2ff765dc01fa65d10d6b322f_hd.jpg" alt="img">SxS网格与bounding box关系（图中S=7，row=4且col=1）</p>
<p>如图5，在YOLO中输入图像被分为SxS网格。假设有一个bounding box（如图4红框），其中心刚好落在了(row,col)网格中，则这个网格需要负责预测整个红框中的dog目标。假设图像的宽为widthimage，高为heightimage；红框中心在(xc，yc)，宽为widthbox，高为heightbox那么：</p>
<p><strong>(1) 对于bounding box的宽和高做如下normalization，使得输出宽高介于0~1：</strong></p>
<p><img src="https://pic2.zhimg.com/v2-5eb7009c33c2e097277bb28b0cfa7511_b.jpg" alt="img"><img src="https://pic2.zhimg.com/80/v2-5eb7009c33c2e097277bb28b0cfa7511_hd.jpg" alt="img"></p>
<p><strong>(2) 使用(row, col)网格的offset归一化bounding box的中心坐标：</strong></p>
<p><img src="https://pic2.zhimg.com/v2-65a3c3f8f9b23751cc22cb50e958798d_b.jpg" alt="img"><img src="https://pic2.zhimg.com/80/v2-65a3c3f8f9b23751cc22cb50e958798d_hd.jpg" alt="img"></p>
<p>经过上述公式得到的normalization的(x, y, w, h)，再加之前提到的confidence，共同组成了一个真正在网络中用于回归的bounding box；这里的Xc值的是预测的物体中心点在原图的坐标，Col，row值的是在最后7*7中的bin。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Zhang Yuanhan</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang Yuanhan</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("GxkhTbMmcwkcQBiHFSVpjeJV", "u2grDKr3jJbwNHoKnA7lWj3l");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
